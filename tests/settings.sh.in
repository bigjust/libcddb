#!/bin/sh
# @configure_input@
#
# $Id: settings.sh.in,v 1.4 2003/04/25 17:56:32 airborne Exp $

# location of the example program used in the tests
CDDB_QUERY='@abs_top_builddir@/examples/cddb_query -q'

# location of local test cache
CDDB_CACHE='@abs_srcdir@/testcache'

# location of test data
CDDB_DATA='@abs_srcdir@/testdata'

# test result return codes
SUCCESS=0
FAILURE=1
SKIPPED=77

# libcddb/cddb_query error codes
DISC_NOT_FOUND=11

fail()
{
    printf 'failed.\n'
    exit $FAILURE
}

success()
{
    printf 'ok.\n'
}

check_discid()
{
    DISCID_STR='CD disc ID is '
    EXP_ID=$1
    RET_ID=`sed "/^${DISCID_STR}[0-9a-f]*\$/!d;s/${DISCID_STR}\([0-9a-f]*\)/\1/"`
    printf 'Checking disc ID %s... ' ${EXP_ID}
    if [ ${RET_ID}x != ${EXP_ID}x ]; then
        fail
    fi
    success
}

diff_res_exp()
{
    EXPECTED=$1
    diff - $EXPECTED > /dev/null
    if [ $? -ne 0 ]; then
        fail
    fi
    success
}

check_read()
{
    DISC_ID=$1
    EXP_READ="${CDDB_DATA}/${DISC_ID}.txt"
    printf 'Checking disc read %s... ' ${DISC_ID}
    diff_res_exp $EXP_READ
}

check_query()
{
    QUERY_HASH=$1
    EXP_QUERY="${CDDB_DATA}/${QUERY_HASH}.txt"
    printf 'Checking disc query %s... ' ${QUERY_HASH}
    diff_res_exp $EXP_QUERY
}

check_not_found()
{
    DISC_ID=$1
    RV=$2
    printf 'Checking disc not found %s... ' ${DISC_ID}
    if [ $RV -ne $DISC_NOT_FOUND ]; then
        fail
    fi
    success
}
